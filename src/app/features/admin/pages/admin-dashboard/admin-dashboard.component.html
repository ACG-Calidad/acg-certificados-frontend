<div class="dashboard-container">
  <!-- Page Header -->
  <div class="page-header">
    <h1>Dashboard</h1>
    <p class="subtitle">Resumen de gestión de certificados</p>
  </div>

  <!-- Loading State -->
  @if (loading) {
    <div class="loading-container">
      <mat-spinner></mat-spinner>
      <p>Cargando datos...</p>
    </div>
  }

  <!-- Dashboard Content -->
  @if (!loading) {
    <!-- Stats Cards -->
    <div class="stats-grid">
      <app-stats-card
        icon="workspace_premium"
        [value]="stats.total_certificates"
        label="Total Certificados"
        subtitle="Emitidos históricamente"
        color="primary">
      </app-stats-card>

      <app-stats-card
        icon="pending_actions"
        [value]="stats.pending_certificates"
        label="Pendientes"
        subtitle="Usuarios listos para certificar"
        color="warning">
      </app-stats-card>

      <app-stats-card
        icon="calendar_month"
        [value]="stats.this_month_certificates"
        label="Este Mes"
        subtitle="Certificados generados"
        color="success">
      </app-stats-card>

      <app-stats-card
        icon="notifications_active"
        [value]="stats.pending_notifications"
        label="Notificaciones"
        subtitle="Pendientes de enviar"
        color="info">
      </app-stats-card>
    </div>

    <!-- Charts and Tables Row -->
    <div class="content-grid">
      <!-- Monthly Chart -->
      <mat-card class="chart-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>bar_chart</mat-icon>
            Certificados por Mes
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="chart-container">
            @for (data of monthlyData; track data.month) {
              <div class="chart-bar-wrapper">
                <div class="chart-bar" [style.height.%]="getBarHeight(data.count)">
                  <span class="bar-value">{{ data.count }}</span>
                </div>
                <span class="bar-label">{{ data.month }}</span>
              </div>
            }
          </div>
        </mat-card-content>
      </mat-card>

      <!-- Top Courses -->
      <mat-card class="top-courses-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>school</mat-icon>
            Top Cursos
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="courses-list">
            @for (course of topCourses; track course.course_id; let i = $index) {
              <div class="course-item">
                <span class="course-rank">{{ i + 1 }}</span>
                <div class="course-info">
                  <span class="course-name">{{ course.course_name }}</span>
                  <span class="course-code">{{ course.course_shortname }}</span>
                </div>
                <span class="course-count">{{ course.certificate_count }}</span>
              </div>
            }
          </div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Recent Activity -->
    <mat-card class="activity-card">
      <mat-card-header>
        <mat-card-title>
          <mat-icon>history</mat-icon>
          Actividad Reciente
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="activity-list">
          @for (activity of recentActivity; track activity.id) {
            <div class="activity-item">
              <div class="activity-icon" [ngClass]="getActivityColor(activity.action)">
                <mat-icon>{{ getActivityIcon(activity.action) }}</mat-icon>
              </div>
              <div class="activity-content">
                <p class="activity-description">{{ activity.description }}</p>
                <span class="activity-time">{{ formatDate(activity.timestamp) }}</span>
              </div>
            </div>
          }
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Quick Actions -->
    <div class="quick-actions">
      <button mat-raised-button color="primary" routerLink="/management/pending">
        <mat-icon>pending_actions</mat-icon>
        Ver Pendientes
      </button>
      <button mat-stroked-button routerLink="/management/notifications">
        <mat-icon>email</mat-icon>
        Enviar Notificaciones
      </button>
      <button mat-stroked-button (click)="downloadReport()" [disabled]="downloadingReport">
        @if (downloadingReport) {
          <mat-spinner diameter="20"></mat-spinner>
        } @else {
          <mat-icon>download</mat-icon>
        }
        Descargar Reporte
      </button>
    </div>
  }
</div>
